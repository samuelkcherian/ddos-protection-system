<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>DDoS Monitoring Tool</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="navbar">
        <div class="title">DDoS Monitoring Tool</div>
        <div class="profile-icon">ðŸ‘¤</div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>IP Address</th>
                    <th>Packet Count</th>
                    <th>Last Seen</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="trafficTable"></tbody>
        </table>
    </div>

    <script>
        function fetchData() {
            fetch("/data")
                .then(res => res.json())
                .then(data => {
                    const table = document.getElementById("trafficTable");
                    table.innerHTML = "";
                    data.forEach(d => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${d.ip}</td>
                            <td>${d.packet_count || '0'}</td>
                            <td>${d.last_seen || ''}</td>
                            <td class="${d.status.toLowerCase()}">${d.status}</td>
                            <td>${d.status === 'Blocked' ? '<button onclick="unblockIP(\\'' + d.ip + '\\')">Unblock</button>' : ''
                    }</td >
                        `;
                        table.appendChild(row);
                    });
                });
        }

        function unblockIP(ip) {
            fetch("/unblock", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ip })
            }).then(() => fetchData());
        }

        setInterval(fetchData, 2000);
        fetchData();
    </script>
</body>

</html>