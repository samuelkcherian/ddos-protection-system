<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>DDoS Monitoring Tool</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body {
            cursor: none;
            overflow-x: hidden;
        }

        .trail {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 0, 255, 0.8) 0%, transparent 70%);
            pointer-events: none;
            animation: fadeOut 0.5s ease-out forwards;
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
                transform: scale(2);
            }
        }
    </style>
</head>

<body>
    <div class="profile-dropdown">
        <div class="profile-icon">üë§</div>
        <div class="dropdown-content">
            <a href="#">Settings</a>
            <a href="/logout">Logout</a>
        </div>
    </div>
    <div class="navbar">
        <div class="title">DDoS Monitoring Tool</div>
        <div class="profile-icon">üë§</div>
    </div>

    <div class="domain-monitor-container">
        <input type="text" id="domainInput" placeholder="Enter domain (e.g., example.com)">
        <button onclick="monitorDomain()">Monitor Domain</button>
    </div>

    <div class="table-container" style="max-height: 400px; overflow-y: auto;">
        <table class="min-w-full bg-[#1e1e2f] text-white rounded-lg overflow-hidden shadow-lg">
            <thead class="bg-purple-700 text-left text-sm uppercase tracking-wider">
                <tr>
                    <th class="px-4 py-3">IP Address</th>
                    <th class="px-4 py-3">Packet Count</th>
                    <th class="px-4 py-3">Last Seen</th>
                    <th class="px-4 py-3">Status</th>
                    <th class="px-4 py-3">Suspicion Score</th>
                    <th class="px-4 py-3">Action</th>
                </tr>
            </thead>
            <tbody id="trafficTable" class="bg-[#2a2a3d] text-sm font-medium"></tbody>
        </table>
    </div>

    <script>
        function fetchData() {
            fetch("/data")
                .then(res => res.json())
                .then(data => {
                    const tableBody = document.getElementById("trafficTable");
                    tableBody.innerHTML = "";

                    data.forEach(entry => {
                        const ip = entry.ip;
                        const count = entry.packet_count;
                        const lastSeen = new Date(entry.last_seen).toLocaleString();
                        const status = entry.status;
                        const score = entry.suspicion_score || 0;

                        let scoreClass = "";
                        if (score >= 70) {
                            scoreClass = "text-red-500 font-bold";
                        } else if (score >= 40) {
                            scoreClass = "text-yellow-400 font-semibold";
                        } else {
                            scoreClass = "text-green-400";
                        }

                        let statusClass = "";
                        if (status === "Blocked") statusClass = "bg-red-800 text-white";
                        else if (status === "Suspicious") statusClass = "bg-yellow-700 text-black";
                        else if (status == "Monitoring") statusClass = "bg-blue-800 text-white";
                        else statusClass = "bg-green-700 text-white";

                        const row = `
                          <tr class="border-b border-gray-600 hover:bg-[#33334d] transition duration-200">
                            <td class="px-4 py-2">${ip}</td>
                            <td class="px-4 py-2">${count}</td>
                            <td class="px-4 py-2">${lastSeen}</td>
                            <td class="px-4 py-2 ${statusClass} rounded">${status}</td>
                            <td class="px-4 py-2 ${scoreClass}">${score}</td>
                            <td class="px-4 py-2">
                                ${status === "Blocked" ? `
                                  <button onclick="unblockIP('${ip}')" class="bg-pink-600 hover:bg-pink-700 text-white text-xs px-2 py-1 rounded">
                                    Unblock
                                  </button>` : ""}
                            </td>
                          </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                });
        }


        function unblockIP(ip) {
            fetch("/unblock", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ ip })
            }).then(() => fetchData());
        }

        setInterval(fetchData, 3000);
        fetchData();

    </script>

    <script>
        document.addEventListener("mousemove", e => {
            const trail = document.createElement("div");
            trail.className = "trail";
            trail.style.left = `${e.clientX}px`;
            trail.style.top = `${e.clientY}px`;
            document.body.appendChild(trail);
            setTimeout(() => trail.remove(), 500);
        });

    </script>
    <script>
        function monitorDomain() {
            const domainInput = document.getElementById("domainInput").value;
            if (!domainInput) return alert("Please enter a domain name");

            fetch("/monitor", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ domain: domainInput })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.error) {
                        alert("‚ùå " + data.error);
                    } else {
                        alert(`‚úÖ Domain resolved to IP: ${data.ip}`);
                        fetchData();  // Refresh dashboard data
                    }
                })
                .catch(err => {
                    console.error("Error monitoring domain:", err);
                    alert("‚ö†Ô∏è Error sending domain for monitoring");
                });
        }
    </script>
    <link rel="icon" href="data:,">
    <footer style="text-align: center; margin-top: 20px; padding: 10px; color: #bbb;font-size: 14px;">
        ¬© 2025. Developed by <a href="https://github.com/samuelkcherian" target="_blank"
            style="color: #c57bff; text-decoration: none;">Samuel</a>
    </footer>
</body>

</html>